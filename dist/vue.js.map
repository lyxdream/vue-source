{"version":3,"file":"vue.js","sources":["../src/utils.js","../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["//此处存放所有的工具方法\n\nexport function isObject(obj){\n    return typeof obj =='object' && obj!==null\n}","let oldArrayMethods = Array.prototype;//获取数组原型上的方法\n//创建一个全新的对象 可以找到数组原型上的方法，而且修改对象时不会影响原数组的原型方法\n// Object.create()方法会创建一个新对象，使用现有对象来提供新创建的对象的__proto__\nexport let arrayMethods = Object.create(oldArrayMethods);\nlet methods = [  //这七个方法都可以改变原数组\n    'push',\n    'pop',\n    'shift',\n    'unshift',\n    'sort',\n    'reverse',\n    'splice'\n]\nmethods.forEach(method =>{   //函数劫持 \bAOP\n    console.log(method)\n    // 这样就调用arrayMethods自身的方法，但是这样不会发生变化\n    //于是就需要调用数组原来的方法，既函数劫持\n    arrayMethods[method] = function(...args){\n        //当用户调用数组的方法时 先执行我自己改造的逻辑 再执行数组默认的逻辑\n        const ob = this.__ob__;\n        console.log(ob)\n        let result =  oldArrayMethods[method].apply(this,args);\n        let inserted;\n        //push unshift splice 都可以新增属性 （新增的属性可能是一个对象类型）\n        //内部还对数组中引用类型也做了一次劫持\n        switch(method){\n            case 'push':\n            case 'unshift':\n                  inserted = args;\n                break;\n            case 'splice':    //也是新增属性 可以修改 可以删除   [].splice(arr,1,'div')\n                inserted = args.slice(2);\n                break;\n            default:\n                break;\n        }\n        inserted&&ob.observeArray(inserted);//观测数组中新增的每一项\n        console.log('新增')\n        return result;\n\n    }\n})\n","import {isObject} from '../utils.js'\nimport { arrayMethods } from './array'\n class Observer{\n   constructor(data){\n      console.log(data)\n    // 对数组索引进行拦截 性能差而且直接更改索引的方式并不多\n    Object.defineProperty(data,'__ob__',{\n        enumerable:false,\n        configurable:false,\n        value:this\n    })\n    // data._ob_  = this;//可以在数据上获取_ob_这个属性 指代的是Observer的实例\n    if(Array.isArray(data)){\n        //vue 如何对数组进行处理？数组用的是重写数组的方法 函数劫持\n        //改变的数组方法就可以监控到了 改写了数组的原型链\n        data.__proto__ = arrayMethods;//通过原型链 向上查找的方式\n        //[{a:1}] =>arr[0].a = 100\n        this.observeArray(data);//观测数组中的每一项 \n    }else{\n        this.walk(data) //可以对数据一步步的处理\n    }\n   }\n   //检测数组中引用类型的方法\n   observeArray(data){\n       for(let i=0;i<data.length;i++){\n            observe(data[i])\n       }\n   }\n   walk(data){\n        //对象的循坏\n        // console.log(Object.keys(data))\n        Object.keys(data).forEach(key=>{\n            defineReactive(data,key,data[key]);//定义响应式的数据变化\n            // console.log(key)\n        })\n   }\n\n}\n//vue2的性能 递归重写get和set \nfunction defineReactive(data,key,value){\n    observe(value);//如果传入的值还是一个对象就做递归循环检测\n    Object.defineProperty(data,key,{\n        get(){\n            return value;\n        },\n        set(newValue){\n             if(newValue=== value) return;\n             observe(newValue);//检测当前设置的值是否是一个对象 //有可能用户给的新值是一个对象\n            value = newValue\n        }\n    })\n}\nexport function observe(data){\n    //对象就是使用 define\bProperty来实现响应式原理\n    // console.log(data)\n    //如果这个数据不是对象 或者是null 那就不用监控了\n    if(!isObject(data)){\n        return;\n    }\n    if(data.__ob__ instanceof Observer){  //防止对象被重复观测\n         return;\n    }\n    //对数据进行defineProperty  \n    return new Observer(data) //可以看到当前数据是否被观测过\n   \n}","import {observe} from './observe/index.js'\nexport function initState(vm){\n    const opts = vm.$options;\n    if(opts.props){\n        initProps(vm)\n    }\n    if(opts.methods){\n        initMethod(vm);\n    }\n    if(opts.data){\n        initData(vm);\n    }\n    //computed ...watch\n}\nfunction initProps(){\n\n}\nfunction initMethod(){\n\n}\nfunction initData(vm){\n    //数据响应式\n    // console.log(vm.$options.data)\n let data = vm.$options.data;\n //vm._data检测后的数据\n data = vm._data = typeof data==='function' ?data.call(vm):data;\n//  console.log(data)\n //观测数据\n  observe(data);\n}","import {initState} from './state.js'\nexport function initMixin(Vue){\n    Vue.prototype._init = function(options){\n        // console.log(options)\n        //Vue内部的$options 就是用户传递的所有参数\n        const vm = this;\n        vm.$options = options;//用户传入的参数\n        //options.data props watch computed  //状态\n        initState(vm);//初始化状态\n    }\n}","import {initMixin} from './init.js'\nfunction Vue(options){\n    //内部进行初始化的操作\n    this._init(options);//初始化操作\n}\ninitMixin(Vue)  //添加原型的方法\n//组件的初始化\nexport default Vue;"],"names":["isObject","obj","oldArrayMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","console","log","ob","__ob__","args","result","apply","inserted","slice","observeArray","Observer","data","defineProperty","enumerable","configurable","value","isArray","__proto__","walk","i","length","observe","keys","key","defineReactive","get","set","newValue","initState","vm","opts","$options","props","initData","_data","call","initMixin","Vue","_init","options"],"mappings":"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"}